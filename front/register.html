<!DOCTYPE html>
<html lang="fr">
<head>
    <title>Formulaire de Connexion</title>
    <link rel="stylesheet" type="text/css" href="./css/semantic/semantic.min.css">
</head>
<body>
<div class="ui container" style="margin: 10% 10% 10% 10%">
    <h2 class="ui header">Inscription</h2>
    <form class="ui form" id="register-form">
        <div class="field">
            <label>Nom d'utilisateur</label>
            <input type="text" name="username" placeholder="Nom d'utilisateur" required>
        </div>
        <div class="field">
            <label>Email</label>
            <input type="email" name="email" placeholder="Email" required>
        </div>
        <div class="field">
            <label>Mot de passe</label>
            <input type="password" name="password" placeholder="Mot de passe" required>
        </div>
        <div class="field">
            <label>Confirmation du mot de passe</label>
            <input type="password" name="passwordConfirmation" placeholder="Confirmation du mot de passe" required>
        </div>
        <div class="field">
            <p id="error-message" class="ui red message" style="display: none;"></p>
        </div>
        <button class="ui button" type="submit">Inscription</button>
    </form>
</div>
</body>
</html>
<script>
    document.getElementById('register-form').addEventListener('submit', function(event) {
        event.preventDefault();
        const formData = new FormData(event.target);
        const data = Object.fromEntries(formData.entries());
        if (data.password !== data.passwordConfirmation) {
            alert('Les mots de passe ne correspondent pas.');
            return;
        }
        if (data.username.length < 3) {
            alert('Le nom d\'utilisateur doit contenir au moins 3 caractères.');
            return;
        }
        if (data.password.length < 6) {
            alert('Le mot de passe doit contenir au moins 6 caractères.');
            return;
        }

        fetch('/user-service/user', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
        })
            .then(async response =>{
                console.log(response)
                const errorMessageElement = document.getElementById('error-message');
                if (await response.status === 200) {
                    errorMessageElement.style.display = 'none'
                    window.location = "/connexion.html"

                } else {
                    errorMessageElement.textContent = 'Erreur lors de l\'inscription: ' +  await response.text() ;
                    errorMessageElement.style.display = '';
                }
            })
            .catch((error) => {
                console.error('Error:', error);
            });
    });

</script>